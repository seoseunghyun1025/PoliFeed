<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë‚´ìš© ìˆ˜ì • ë° ì¬ë¶„ì„</title> <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        textarea { resize: none; }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container">
        <a class="navbar-brand" href="/">PoliFeed</a>
        <div class="d-flex" th:if="${userName != null}">
            <span class="navbar-text text-white me-3">
                ë°˜ê°‘ìŠµë‹ˆë‹¤, <strong th:text="${userName}">User</strong>ë‹˜!
            </span>
            <a href="/logout" class="btn btn-sm btn-outline-light">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-warning text-dark fw-bold">âœï¸ ë‚´ìš© ìˆ˜ì •í•˜ê¸°</div> <div class="card-body">

                <form th:action="@{/analyze/update}" method="post" onsubmit="showLoading()">

                    <input type="hidden" name="id" th:value="${dto.id}">

                    <div class="mb-3">
                        <label for="topic" class="form-label fw-bold">ğŸ“Œ ì£¼ì œ</label>
                        <label for="topic" class="form-label fw-bold">ğŸ¢ ê¸°ì—… ì œì‹œ ë¬¸í•­</label>
                        <input type="text" id="topic" name="topic" class="form-control"
                               th:value="${dto.topic}" required>
                    </div>

                    <textarea name="resumeText" class="form-control mb-3" rows="15"
                              th:text="${dto.originalText}"></textarea>

                    <button type="submit" id="submitBtn" class="btn btn-warning w-100 fw-bold">
                        ìˆ˜ì •í•˜ê³  ë‹¤ì‹œ í”¼ë“œë°± ë°›ê¸° ğŸ”„
                    </button>
                </form>
            </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm h-100 border-info">
                <div class="card-header bg-info text-white fw-bold">ğŸ¤– AI ë©˜í† ì˜ í”¼ë“œë°± (ìµœì‹ )</div>
                <div class="card-body bg-white position-relative">

                    <div id="loading-spinner" class="text-center mt-5" style="display: none;">
                        <div class="spinner-border text-info" role="status" style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3 fw-bold text-secondary">ìˆ˜ì •ëœ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ<br>ë‹¤ì‹œ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤... ğŸ§</p>
                    </div>

                    <div>
                        <pre id="feedback-content" th:text="${dto.feedbackText}"
                             style="white-space: pre-wrap; font-family: inherit; max-height: 500px; overflow-y: auto;"></pre>

                        <hr>

                        <div class="text-end">
                            <button onclick="downloadFeedback()" class="btn btn-outline-dark btn-sm">
                                ğŸ“¥ í”¼ë“œë°± ë‹¤ìš´ë¡œë“œ (.txt)
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="mt-3 mb-5">
        <a href="/mypage" class="btn btn-secondary">â¬…ï¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
</div>

<script>
    function showLoading() {
        document.getElementById('loading-spinner').style.display = 'block';
    }

    function downloadFeedback() {
        const content = document.getElementById('feedback-content').innerText;
        if (!content) { alert("ë‹¤ìš´ë¡œë“œí•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤."); return; }

        const element = document.createElement('a');
        const file = new Blob([content], {type: 'text/plain'});
        element.href = URL.createObjectURL(file);
        element.download = "PoliFeed_Updated_Feedback.txt"; // íŒŒì¼ëª… ì‚´ì§ ë³€ê²½
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);
    }
</script>

</body>
</html>